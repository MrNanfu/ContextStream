---
layout: project_page
permalink: /

title: "AutoRAG-HP: Automatic Online Hyper-Parameter Tuning for Retrieval-Augmented Generation"

authors: |
    Jia Fu<sup>1, 2</sup>*, Xiaoting Qin<sup>3</sup>, Fangkai Yang<sup>3</sup>, Lu Wang<sup>3</sup>, Jue Zhang<sup>3</sup>†, Qingwei Lin<sup>3</sup>, Yubo Chen<sup>1, 2</sup>, Dongmei Zhang<sup>3</sup>, Saravan Rajmohan<sup>3</sup>, Qi Zhang<sup>3</sup>

affiliations: |
    <sup>1</sup> Institute of Automation, Chinese Academy of Sciences, Beijing, China,<br>
    <sup>2</sup> School of Artificial Intelligence, University of Chinese Academy of Sciences,<br>
    <sup>3</sup> Microsoft

notes: |
    * Work is done during an internship at Microsoft.
    † Corresponding author.

contact: |
    fujia2021@ia.ac.cn, yubo.chen@nlpr.ia.ac.cn   <br>
    {xiaotingqin, fangkaiyang, wlu, juezhang, qlin}@microsoft.com

paper: |
    https://arxiv.org/abs/2406.19251

code: |
    Coming soon
---

<!-- 
# paper: https://www.cs.virginia.edu/~robins/Turing_Paper_1936.pdf
#  <span>^1^Microsoft,</span> <span>^2^Institute of Automation, Chinese Academy of Sciences,</span> <span>^3^School of Artificial Intelligence, University of Chinese Academy of Sciences,</span>
    # Microsoft
    # Institute of Automation, Chinese Academy of Sciences
    # School of Artificial Intelligence, University of Chinese Academy of Sciences
# paper: 'coming soon'
# video: https://www.youtube.com/results?search_query=turing+machine
# code: 'coming soon'
# data: https://huggingface.co/docs/datasets
 -->

<video width="100%" height="auto" controls>
  <source src="{{ site.baseurl }}/static/video/AutoRAG.mp4" type="video/mp4">
</video>

---

<!-- Using HTML to center the abstract -->
<div class="columns is-centered has-text-centered">
    <div class="column is-four-fifths">
        <h2>Abstract</h2>
        <div class="content has-text-justified">
Recent advancements in Large Language Models have transformed ML/AI development, necessitating a reevaluation of AutoML principles for the Retrieval-Augmented Generation (RAG) systems. To address the challenges of hyper-parameter optimization and online adaptation in RAG, we propose the AutoRAG-HP framework, which formulates the hyper-parameter tuning as an online multi-armed bandit (MAB) problem and introduces a novel two-level Hierarchical MAB (Hier-MAB) method for efficient exploration of large search spaces. We conduct extensive experiments on tuning hyper-parameters, such as top-k retrieved documents, prompt compression ratio, and embedding methods, using the ALCE-ASQA and Natural Questions datasets. Our evaluation from jointly optimization all three hyper-parameters demonstrate that MAB-based online learning methods can achieve Recall@5 $\approx 0.8$ for scenarios with prominent gradients in search space, using only 20% of the LLM API calls required by the Grid Search approach. Additionally, the proposed Hier-MAB approach outperforms other baselines in more challenging optimization scenarios.
        </div>
    </div>
</div>



<!-- > Note: This is an example of a Jekyll-based project website template: [Github link](https://github.com/shunzh/project_website).\
> The following content is generated by ChatGPT. The figure is manually added. -->

## Key Contributions
1. We introduce the AutoRAG-HP framework to address the pressing needs for optimal hyper-parameter tuning in RAG. To our best knowledge, we are the first to discuss the automatic online hyper-parameter tuning in RAG.

2. We formulate the online hyper-parameter search in RAG as a multi-armed bandit problem and propose a novel two-level hierarchical multi-armed bandit method to efficiently explore large search space.

3. The efficacy of our approach is validated across several scenarios using public datasets.

<div align="center">
    <img src= "{{ site.baseurl }}/static/image/sample_RAG.png" alt="Hierarchical UCB" style="width: 60%;">
    <p><em>Figure 1: An example RAG system.</em></p>
</div>

<br><br> <!-- Adding two extra empty lines -->

<div align="center">
    <img src= "{{ site.baseurl }}/static/image/hier_MAB.png" alt="Hierarchical UCB" style="width: 60%; display: block; margin-left: auto; margin-right: auto;">
    <p><em>Figure 2: An example of two-level hierarchical MAB.</em></p>
</div>



<!-- 
## Grid Search Results for ASQA with GPT-4

<img src= "{{ site.baseurl }}/static/image/gt_asqa_4.png" alt="Grid Search Results" style="width: 80%; display: block; margin-left: auto; margin-right: auto;">

*Figure 2: Grid search results for ASQA with GPT-4. Error bars represent the standard deviations of accuracy and reward values across all batches.*


## Main Results 

<img src= "{{ site.baseurl }}/static/image/ASQA_gpt4_2_param_alpha_1-NQ_gpt4_2_param_alpha_1_topk_3_interval_100.png"
 alt="Main Results" style="width: 80%; display: block; margin-left: auto; margin-right: auto;">

*Figure 3: Evolution of Recall@3 in the optimization of $(\mathcal{K}, \mathcal{C})$ for the GPT-4 case.*


<img src="{{ site.baseurl }}/static/image/ASQA_gpt4_3_param_alpha_1-NQ_gpt4_3_param_alpha_1_topk_5_interval_100.png" alt="Main Results" style="width: 80%; display: block; margin-left: auto; margin-right: auto;">

*Figure 4: Evolution of Recall@5 in the optimization of $(\mathcal{K}, \mathcal{C}, \mathcal{E})$ for the GPT-4 case.*
 -->

<!-- ## Table: Comparison of Computable and Non-Computable Numbers

| Computable Numbers | Non-Computable Numbers |
|-------------------|-----------------------|
| Rational numbers, e.g., 1/2, 3/4 | Transcendental numbers, e.g., π, e |
| Algebraic numbers, e.g., √2, ∛3 | Non-algebraic numbers, e.g., √2 + √3 |
| Numbers with finite decimal representations | Numbers with infinite, non-repeating decimal representations |

He used the concept of a universal Turing machine to prove that the set of computable functions is recursively enumerable, meaning it can be listed by an algorithm. -->
<!-- 
## Significance
Turing's paper laid the foundation for the theory of computation and had a profound impact on the development of computer science. The Turing machine became a fundamental concept in theoretical computer science, serving as a theoretical model for studying the limits and capabilities of computation. Turing's work also influenced the development of programming languages, algorithms, and the design of modern computers. -->

## Citation
```
@misc{fu2024autoraghpautomaticonlinehyperparameter,
      title={AutoRAG-HP: Automatic Online Hyper-Parameter Tuning for Retrieval-Augmented Generation}, 
      author={Jia Fu and Xiaoting Qin and Fangkai Yang and Lu Wang and Jue Zhang and Qingwei Lin and Yubo Chen and Dongmei Zhang and Saravan Rajmohan and Qi Zhang},
      year={2024},
      eprint={2406.19251},
      archivePrefix={arXiv},
      primaryClass={cs.CL},
      url={https://arxiv.org/abs/2406.19251}, 
}
```
